<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running BDSIM" href="running.html" />
    <link rel="prev" title="Introduction" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#supported-systems">Supported Systems</a></li>
<li class="toctree-l2"><a class="reference internal" href="#source-code">Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#solutions">Solutions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pre-compiled-libraries">Pre-Compiled Libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#public-installation-on-cvmfs">Public Installation on CVMFS</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#centos-7-with-cvmfs-access">CentOS 7 with CVMFS Access</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#compilation-from-source">Compilation From Source</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bdsim-on-windows">BDSIM on Windows</a></li>
<li class="toctree-l3"><a class="reference internal" href="#docker">Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#docker-local-build">Docker Local Build</a></li>
<li class="toctree-l4"><a class="reference internal" href="#basic-docker-commands">Basic Docker Commands</a></li>
<li class="toctree-l4"><a class="reference internal" href="#x11-notes">X11 Notes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#apptainer-formerly-singularity">Apptainer (formerly Singularity)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#requirements-environment">Requirements &amp; Environment</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#geant4-clhep-and-root-versions">Geant4, CLHEP and ROOT Versions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geant4-environment">Geant4 Environment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compilation-environment-setup">Compilation Environment Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mac-osx-generally">Mac OSX Generally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#linux-generally">Linux Generally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#clhep-installation-guide">CLHEP Installation Guide</a></li>
<li class="toctree-l3"><a class="reference internal" href="#geant4-installation-guide">Geant4 Installation Guide</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#compiling-bdsim">Compiling BDSIM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuring-the-build">Configuring the Build</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#optional-configuration-options">Optional Configuration Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#giving-cmake-hints-for-packages">Giving CMake Hints for Packages</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-a-root-installation">Specifying a ROOT Installation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#advanced-configuration-options">Advanced Configuration Options</a></li>
<li class="toctree-l4"><a class="reference internal" href="#environmental-variables">Environmental Variables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#python-utilities">Python Utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#updating-the-python-utilities">Updating the Python Utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#upgrading-bdsim">Upgrading BDSIM</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#clean-build">Clean Build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#updated-existing-build">Updated Existing Build</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#xwindows-with-macos">XWindows With MacOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#programs-included">Programs Included</a></li>
<li class="toctree-l2"><a class="reference internal" href="#tested-platforms">Tested Platforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Installation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading"></a></h1>
<section id="supported-systems">
<h2>Supported Systems<a class="headerlink" href="#supported-systems" title="Link to this heading"></a></h2>
<p>BDSIM is developed and used on Mac OSX and (Scientific) Linux. It can be used
on Windows through some virtualisation technology (e.g. a virtual machine, docker,
or Cygwin, X11 and CVMFS access). See <a class="reference internal" href="#solution-windows"><span class="std std-ref">BDSIM on Windows</span></a> for Windows setup.</p>
<p>Tested systems: Mac OS 11, 12, both Intel &amp; M1 (ARM64); Centos7, SLC6. A full list
can be found in <a class="reference internal" href="#tested-platforms"><span class="std std-ref">Tested Platforms</span></a>.</p>
<p>Different methods of installation are described in <a class="reference internal" href="#solutions"><span class="std std-ref">Solutions</span></a>.</p>
</section>
<section id="source-code">
<span id="id1"></span><h2>Source Code<a class="headerlink" href="#source-code" title="Link to this heading"></a></h2>
<p>The source code for BDSIM can be obtained from the git repository and is available under
the GPLv3 licence (see <a class="reference internal" href="licence.html#licence"><span class="std std-ref">Licence &amp; Disclaimer</span></a>). If using the source code, then the user must
compile it on their system and must have Geant4, CLHEP and ROOT already present.</p>
<p>Obtaining via the git repository allows easier updates in future as the
user can ‘pull’ the latest version and then recompile without having to
create a separate copy.</p>
<p>To download the source from the git repository, use the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">bdsim</span><span class="o">-</span><span class="n">collaboration</span><span class="o">/</span><span class="n">bdsim</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>or (if you have an SSH key setup with github):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">bdsim</span><span class="o">-</span><span class="n">collaboration</span><span class="o">/</span><span class="n">bdsim</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>This will create a directory called <code class="docutils literal notranslate"><span class="pre">bdsim</span></code>, inside which all the code, examples
and documentation is provided. BDSIM source code versions can be downloaded as zipped
archives from the git repository website:</p>
<p><a class="reference external" href="https://github.com/bdsim-collaboration/bdsim/tags">https://github.com/bdsim-collaboration/bdsim/tags</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you download a tag, this is not necessarily a clone of the git repository and should
not be used as such for development. the repository should be cloned explicitly.</p>
</div>
</section>
<section id="solutions">
<span id="id2"></span><h2>Solutions<a class="headerlink" href="#solutions" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#solution-precompiled"><span class="std std-ref">Pre-Compiled Libraries</span></a></p></li>
<li><p><a class="reference internal" href="#solution-cvmfs"><span class="std std-ref">Public Installation on CVMFS</span></a></p></li>
<li><p><a class="reference internal" href="#solution-from-source"><span class="std std-ref">Compilation From Source</span></a></p></li>
<li><p><a class="reference internal" href="#solution-windows"><span class="std std-ref">BDSIM on Windows</span></a></p></li>
<li><p><a class="reference internal" href="#docker"><span class="std std-ref">Docker</span></a></p></li>
<li><p><a class="reference internal" href="#apptainer"><span class="std std-ref">Apptainer (formerly Singularity)</span></a></p></li>
</ul>
<section id="pre-compiled-libraries">
<span id="solution-precompiled"></span><h3>Pre-Compiled Libraries<a class="headerlink" href="#pre-compiled-libraries" title="Link to this heading"></a></h3>
<p>These are not yet provided but will be shortly.</p>
</section>
<section id="public-installation-on-cvmfs">
<span id="solution-cvmfs"></span><h3>Public Installation on CVMFS<a class="headerlink" href="#public-installation-on-cvmfs" title="Link to this heading"></a></h3>
<p>If you have access to CVMFS (CERN Virtual Machine File System) as your university or lab
is linked in some way with CERN or makes use of CVMFS, you can find builds of BDSIM there.
CVMFS is a file system accessible over the internet, and in a certain folder we have some
pre-made BDSIM libraries. These use CERN software for the all the dependencies also available
on CVMFS. Currently, only Centos7 (CC7) builds are provided.</p>
<section id="centos-7-with-cvmfs-access">
<span id="cvmfs-build"></span><h4>CentOS 7 with CVMFS Access<a class="headerlink" href="#centos-7-with-cvmfs-access" title="Link to this heading"></a></h4>
<p>If you have a machine running CERN CentOS 7 and with access to the CVMFS file system (CERN Virtual Machine
File System), you can access an installation of bdsim at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">cvmfs</span><span class="o">/</span><span class="n">beam</span><span class="o">-</span><span class="n">physics</span><span class="o">.</span><span class="n">cern</span><span class="o">.</span><span class="n">ch</span><span class="o">/</span><span class="n">bdsim</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">centos7</span><span class="o">-</span><span class="n">gcc11</span><span class="o">-</span><span class="n">opt</span>
</pre></div>
</div>
<p>You can source a script for a specific version of Geant4 + BDSIM. e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">/</span><span class="n">cvmfs</span><span class="o">/</span><span class="n">beam</span><span class="o">-</span><span class="n">physics</span><span class="o">.</span><span class="n">cern</span><span class="o">.</span><span class="n">ch</span><span class="o">/</span><span class="n">bdsim</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">centos7</span><span class="o">-</span><span class="n">gcc11</span><span class="o">-</span><span class="n">opt</span><span class="o">/</span><span class="n">bdsim</span><span class="o">-</span><span class="n">env</span><span class="o">-</span><span class="n">v1</span><span class="mf">.7.2</span><span class="o">-</span><span class="n">g4v10</span><span class="mf">.7.2.3</span><span class="o">-</span><span class="n">ftfp</span><span class="o">-</span><span class="n">boost</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Tagged versions (e.g. v1.7.2) will remain even when newer versions of BDSIM are provided.</p></li>
<li><p>“develop” versions can change without notice.</p></li>
<li><p>The scripts require BASH (not ZSH) and currently only work on Centos7 as per the name of the directory.</p></li>
<li><p>Each provides: BDSIM, ROOT, Geant4, CLHEP, Python3, IPython, pybdsim, pymadx, pymad8 and pytransport.</p></li>
</ul>
<p>Each setup script includes Geant4, ROOT, CLHEP, IPython, Python, and all dependencies. This is based
on CERN’s LCG software release (currently #100 for BDSIM). Each build is in a directory with the
naming convention:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bdsim</span><span class="o">-&lt;</span><span class="n">version</span><span class="o">&gt;-</span><span class="n">g4</span><span class="o">&lt;</span><span class="n">g4version</span><span class="o">&gt;.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Optional BDSIM-group patches to Geant4 are represented by an extra patch number (e.g. 10.7.1.1 for our patch
#1 on 10.7.1). The contents of the patches are documented in the build directory in a directory called
“patches” as patch files. These are the patches that were applied to the public source code. Each directory
has a text file in it named with the time of the build and contains any options used to configure the software
so that anyone could reproduce the build.</p>
<p>This may take some time the first time it is used (up to a minute or two), but CVMFS is highly efficient
at caching files and it will subsequently be much faster.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When browsing CVMFS, you may not see the directory <code class="code docutils literal notranslate"><span class="pre">beam-physics.cern.ch</span></code>. It is there though.
Type the full path and it will be accessible.  Once inside this directory (<code class="code docutils literal notranslate"><span class="pre">beam-physics.cern.ch</span></code>)
you will be able to browse normally. CVMFS doesn’t show directories the local computer has
never visited before even though they are accessible.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>MacOS and X11 and 3D visualisation. If using the visualiser on a Centos7 machine remotely (e.g. CERN’s
lxplus) over X-windows from a Mac, you may find that the whilst the visualiser window generally works,
the actual visualisation itself is missing. This is because MacOS, by default, blocks OpenGL over X11.
This should be re-enabled. See <a class="reference internal" href="#mac-xwindows"><span class="std std-ref">XWindows With MacOS</span></a>.</p>
</div>
</section>
</section>
<section id="compilation-from-source">
<span id="solution-from-source"></span><h3>Compilation From Source<a class="headerlink" href="#compilation-from-source" title="Link to this heading"></a></h3>
<p>BDSIM source code can be downloaded and then compiled. For this, you need a compiler to be
available as well as several other libraries. Most of these can be found through a package
manager such as YUM, APT, MacPorts or HomeBrew. However, for Geant4, we recommend compiling
it yourself for the best options compatible with BDSIM. See:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#required-packages"><span class="std std-ref">Requirements &amp; Environment</span></a></p></li>
<li><p><a class="reference internal" href="#build-setup"><span class="std std-ref">Compilation Environment Setup</span></a></p>
<ul class="simple">
<li><p><a class="reference internal" href="#geant4-installation-guide"><span class="std std-ref">Geant4 Installation Guide</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#installation-building"><span class="std std-ref">Compiling BDSIM</span></a></p></li>
</ol>
</section>
<section id="bdsim-on-windows">
<span id="solution-windows"></span><h3>BDSIM on Windows<a class="headerlink" href="#bdsim-on-windows" title="Link to this heading"></a></h3>
<p>BDSIM is available on Windows 10 through installation on the Windows Subsystem for Linux (WSL) which is downloadable
from the Windows store. We currently advise that you should only install BDSIM on WSL 1 as difficulties have been
encountered in installing BDSIM’s dependencies and visualising GUIs with X servers on WSL 2.</p>
<p>An alternative is to use DockerDesktop and build a docker image - instructions below - see <a class="reference internal" href="#docker"><span class="std std-ref">Docker</span></a>.</p>
<p>A number of Linux distributions are available, however BDSIM installation has only been tested
on the Ubuntu distribution at present. Please note that we do not regularly test BDSIM on the Windows subsystems.
Follow the guide on the Microsoft website for installing the subsystem.</p>
<p>To install BDSIM on the subsystem, follow the standard installation guide below. An X server is required to view the
BDSIM visualiser from the Linux subsystem. We recommend installing the XMing display server to your Windows 10 machine;
to view windows with XMing you will need to run the command <code class="code docutils literal notranslate"><span class="pre">export</span> <span class="pre">DISPLAY=:0</span></code> in the Linux Bash environment.
The command should be added to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or profile so that it’s loaded automatically every time.</p>
</section>
<section id="docker">
<span id="id3"></span><h3>Docker<a class="headerlink" href="#docker" title="Link to this heading"></a></h3>
<p>Docker is a virtualisation tool that puts software in a ‘container’. This can be run
independently on an operating system and requires fewer resources than a virtual machine. It therefore
allows us to use say BDSIM a Centos7 container on a Mac or Windows machine.</p>
<p>The initial setup takes about 30 minutes, but after that it is nearly instantaneous to start.</p>
<p>A prebuilt image can be downloaded and run on your computer. First, donwload and install</p>
<section id="docker-local-build">
<h4>Docker Local Build<a class="headerlink" href="#docker-local-build" title="Link to this heading"></a></h4>
<p>Included with BDSIM we have a ‘docker file’ that docker can follow to build an image on your computer.
This contains instructions about getting Centos, installing various packages and compiling Geant4 and
BDSIM. The docker file is a text file that one can read and use as a set of instructions to follow
on your own system should you wish - of course not a literal set of copy-and-paste instructions as it
uses some docker commands.</p>
<p>To use this, do the following:</p>
<ol class="arabic simple">
<li><p>Download the DockerDesktop application (e.g. <a class="reference external" href="https://www.docker.com/products/docker-desktop">https://www.docker.com/products/docker-desktop</a>).</p></li>
<li><p>Clone the BDSIM git repository: <code class="code docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/bdsim-collaboration/bdsim.git</span></code>.</p></li>
<li><p>In a terminal (unix or Cygwin), go to <code class="code docutils literal notranslate"><span class="pre">bdsim/building/docker</span></code>.</p></li>
<li><p>Use the docker build script <code class="code docutils literal notranslate"><span class="pre">source</span> <span class="pre">build-centos-bdsim.sh</span></code> - this may take 20 mins. (*)</p></li>
<li><p>Adapt and use the run script <code class="code docutils literal notranslate"><span class="pre">run-centos-bdsim.sh</span></code> which is made for Mac / unix.</p></li>
</ol>
<p>The last step can commonly be made into an alias in your profile. On the developer’s Mac, this is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">alias</span> <span class="n">bdsimdocker</span><span class="o">=</span><span class="s2">&quot;docker run -t -i -v `pwd`:/hostfs -e DISPLAY=`ipconfig getifaddr en0`:0 --rm bdsim bash</span>
</pre></div>
</div>
<p>This will start a terminal prompt that is a BASH shell ‘inside’ the container, so Centos7, with
everything ready to go and the command <code class="code docutils literal notranslate"><span class="pre">bdsim</span></code> available.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>(*) The command in this script is a docker command and can be used in Windows.</p>
</div>
<p>Some explanation of the contents of the run script. For a Mac, this reduces (removing the comments) to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>DV=`ipconfig getifaddr en0`
docker run -t -i -v `pwd`:/hostfs -e DISPLAY=$DV:0 --rm bdsim bash
</pre></div>
</div>
<p>For docker to send an X-window to the host operating system, it uses the IP address of the computer. The
first command gets this (on a Mac). The second command runs docker and links the display. The image is
called “bdsim” here as per the build script, but it may also be referred to by its docker hexadecimal
image name.</p>
<p>The <code class="code docutils literal notranslate"><span class="pre">-v</span></code> syntax work as <code class="code docutils literal notranslate"><span class="pre">-v</span> <span class="pre">&lt;host_dir_abs_path&gt;:&lt;container_dir_abs_path&gt;</span></code>.</p>
</section>
<section id="basic-docker-commands">
<h4>Basic Docker Commands<a class="headerlink" href="#basic-docker-commands" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">image</span> <span class="pre">ls</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">container</span> <span class="pre">ls</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span> <span class="pre">-t</span> <span class="pre">-i</span> <span class="pre">--rm</span> <span class="pre">&lt;image_name&gt;</span> <span class="pre">bash</span></code></p></li>
</ul>
</section>
<section id="x11-notes">
<h4>X11 Notes<a class="headerlink" href="#x11-notes" title="Link to this heading"></a></h4>
<p>Whilst the docker image will almost certainly work without problem, it is more common to have
some issues with the visualiser, which requires sending the window by X11 (‘xwindows’). A few
notes:</p>
<ul class="simple">
<li><p>On a Mac, you may have to do <code class="code docutils literal notranslate"><span class="pre">xhost</span> <span class="pre">+</span></code> to allow X11 connections over the network.</p></li>
<li><p>On a Mac, you may have to set once <code class="code docutils literal notranslate"><span class="pre">defaults</span> <span class="pre">write</span> <span class="pre">org.xquartz.X11</span> <span class="pre">enable_iglx</span> <span class="pre">-bool</span> <span class="pre">true</span></code>.</p></li>
<li><p>See <a class="reference internal" href="#mac-xwindows"><span class="std std-ref">XWindows With MacOS</span></a>.</p></li>
</ul>
</section>
</section>
<section id="apptainer-formerly-singularity">
<span id="apptainer"></span><h3>Apptainer (formerly Singularity)<a class="headerlink" href="#apptainer-formerly-singularity" title="Link to this heading"></a></h3>
<p>Apptainer (formerly known as singularity) is a container system similar to Docker. A key difference
is that apptainer does not need administrator (root) access to run and therefore can be used on
institute-provided machines such as <cite>lxplus</cite> at CERN for example.</p>
<p>Currently, the apptainer containers are built from the docker images. BDSIM can be run as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apptainer</span> <span class="n">run</span> <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">jairhul</span><span class="o">/</span><span class="n">centos7</span><span class="o">-</span><span class="n">geant4v10</span><span class="mf">.7.4</span><span class="o">-</span><span class="n">environment</span> <span class="n">bash</span>
</pre></div>
</div>
<p>Initially, this will take some time to download and convert to the apptainer format (e.g. 1-2 hours).
After this initial step, it will run nearly instantly.</p>
</section>
</section>
<section id="requirements-environment">
<span id="required-packages"></span><h2>Requirements &amp; Environment<a class="headerlink" href="#requirements-environment" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p>A recent compiler with full C++11 support. Proven compiler versions are GCC 4.9 or higher,
or clang 6 or higher.</p></li>
<li><p><a class="reference external" href="http://www.cmake.org/">CMake</a> 3.5 or higher (Geant4.10.2 onward requires <a class="reference external" href="http://www.cmake.org/">CMake</a> 3.3 or higher).</p></li>
<li><p><a class="reference external" href="http://proj-clhep.web.cern.ch/">CLHEP</a> 2.1.3.1 or higher, see also <a class="reference internal" href="#clhep-installation-guide">CLHEP Installation Guide</a>. Latest recommended but must be compatible with Geant4 version.</p></li>
<li><p><em>Optional</em> - Python (&gt;=3.6) for Python utilities and easy data loading with ROOT.</p></li>
<li><p><a class="reference external" href="http://root.cern.ch/">ROOT</a> 6.0 or higher, for output &amp; analysis compiled <strong>with</strong> Python3 support.</p></li>
<li><p><em>Optional</em> - Qt5 libraries for the best Geant4 visualiser (Qt6 not supported in Geant4)</p></li>
<li><p><em>Optional</em> - Xerces-C++ 3.2 XML library for GDML geometry file loading in Geant4.</p></li>
<li><p><a class="reference external" href="http://geant4.cern.ch/">Geant4</a>  - version 4.10 or higher (latest patch of that release). <strong>Recommend 10.7.p04</strong> or <strong>10.4.p03</strong> (for LHC energies). See <a class="reference internal" href="#id4">Geant4 Installation Guide</a></p></li>
<li><p>Flex 2.5.37 or higher.</p></li>
<li><p>Bison 2.3 or higher.</p></li>
<li><p><em>Optional</em> - HepMC3 for loading event generator output.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These are listed in the correct order of installation / requirement.</p>
</div>
<p>For nice analysis and use of <cite>pybdsim</cite> for model conversion, we recommend Python 3 series with
matplotlib and numpy. ROOT should be installed with Python support in this case and with the
<strong>same</strong> Python installation as will be used with the Python utilities.</p>
<section id="geant4-clhep-and-root-versions">
<h3>Geant4, CLHEP and ROOT Versions<a class="headerlink" href="#geant4-clhep-and-root-versions" title="Link to this heading"></a></h3>
<p>We have found some problems with certain versions of software and these should be
avoided. Generally, we recommend the latest patch version of Geant4. These are the
problems we have found:</p>
<ul class="simple">
<li><p>Geant4 10.3.0  - excessively long overlap checking - 15 mins per solid vs normal 40ms.</p></li>
<li><p>Geant4 10.3.pX - generic biasing has no effect - same code works in every other version.</p></li>
<li><p>Geant4 10.4.0  - crash within constructor of G4ExtrudedSolid used extensively in BDSIM.</p></li>
<li><p>Geant4 10.5.0  - the cashkarp integrator for fields will always crash. Events are not independent in rare occasions because of the magnetic field handling.</p></li>
<li><p>Geant4 10.5.pX - bug in G4Extruded solid may occasionally lead to crashes depending on the geometry involved.</p></li>
<li><p>Geant4 10.5 onwards - diffractive proton physics on light target nuclei is disabled by default (on going fix).</p></li>
<li><p>Geant4 11.0 - Bragg peaks are wrong from carbon ions in water.</p></li>
</ul>
<p>The authors typically use Geant4 10.4.p03 or Geant4.10.7.p01 for physics results production.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CLHEP 2.4.4.1 is required for Geant4 10.7 onwards as the SI units were updated to SI2019. Therefore,
we should also be careful about using earlier versions of Geant4 with this version of CLHEP depending
on how sensitive your simulation is. Nominally, it should make a negligible difference.</p>
</div>
</section>
<section id="geant4-environment">
<h3>Geant4 Environment<a class="headerlink" href="#geant4-environment" title="Link to this heading"></a></h3>
<p>Note: even though installed, the Geant4 environmental variables must be
available. You can test this in a terminal with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>echo $G4 &lt;tab&gt;
 $G4ABLADATA         $G4NEUTRONHPDATA    $G4RADIOACTIVEDATA
 $G4LEDATA           $G4NEUTRONXSDATA    $G4REALSURFACEDATA
 $G4LEVELGAMMADATA   $G4PIIDATA          $G4SAIDXSDATA
</pre></div>
</div>
<p>If these do not exist, please source the Geant4 environmental script
before installing BDSIM and each time before using BDSIM. It is common
to add this to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or profile so that it’s loaded automatically
every time:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">geant4</span><span class="o">/</span><span class="n">installation</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">geant4</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</section>
</section>
<section id="compilation-environment-setup">
<span id="build-setup"></span><h2>Compilation Environment Setup<a class="headerlink" href="#compilation-environment-setup" title="Link to this heading"></a></h2>
<p>The following sections detail the setup process for different operating systems.</p>
<section id="mac-osx-generally">
<h3>Mac OSX Generally<a class="headerlink" href="#mac-osx-generally" title="Link to this heading"></a></h3>
<p>In this order:</p>
<ol class="arabic simple">
<li><p>XCode should be installed.</p></li>
<li><p>XCode command line tools should be installed (<code class="code docutils literal notranslate"><span class="pre">xcode-select</span> <span class="pre">--install</span></code>).</p></li>
<li><p>XCode should be opened at least once and the license terms accepted.</p></li>
<li><p>XQuartz should be installed - see <a class="reference external" href="https://www.xquartz.org">https://www.xquartz.org</a>.</p></li>
<li><p>The <cite>make</cite> command is available in the terminal.</p></li>
</ol>
<p>We recommend obtaining <a class="reference internal" href="#required-packages"><span class="std std-ref">Requirements &amp; Environment</span></a> using either <strong>HomeBrew</strong> or <a class="reference external" href="http://www.macports.org/">MacPorts</a>
package managesr, although they can be obtained both through other package managers and by
manually downloading, compiling and installing the source for each.</p>
<p>For Homebrew you can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">brew</span> <span class="n">install</span> <span class="n">root6</span>
<span class="n">brew</span> <span class="n">install</span> <span class="n">xerces</span><span class="o">-</span><span class="n">c</span> <span class="n">flex</span> <span class="n">bison</span> <span class="n">clhep</span> <span class="n">qt</span><span class="o">@</span><span class="mi">5</span>
</pre></div>
</div>
<p>For <strong>HomeBrew</strong>, you should use a virtual env for python and then should install any Python packages
through pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">matplotlib</span> <span class="n">numpy</span>
</pre></div>
</div>
<p>To setup a virutal environment for Python, you can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="o">/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">new</span><span class="o">/</span><span class="n">virtual</span><span class="o">/</span><span class="n">environment</span>
<span class="n">source</span> <span class="o">&lt;</span><span class="n">venv</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>Explicitly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">venv</span> <span class="o">~/</span><span class="n">venv</span><span class="o">/</span><span class="n">py311</span>
</pre></div>
</div>
<p>Edit <code class="code docutils literal notranslate"><span class="pre">.profile</span></code> and add:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/</span><span class="n">venv</span><span class="o">/</span><span class="n">py311</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
</pre></div>
</div>
<p>For <strong>MacPorts</strong> you can do:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">root6</span> <span class="o">+</span><span class="n">python39</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">xercesc3</span> <span class="n">flex</span> <span class="n">bison</span> <span class="n">clhep</span> <span class="n">qt5</span>
<span class="n">sudo</span> <span class="n">port</span> <span class="n">install</span> <span class="n">py39</span><span class="o">-</span><span class="n">matplotlib</span> <span class="n">py39</span><span class="o">-</span><span class="n">numpy</span>
</pre></div>
</div>
<ul class="simple">
<li><p>It is best to install Geant4 manually to ensure you use the system CLHEP option (required
by BDSIM for strong reproducibility) as well as visualiser choices and GDML geometry
loading.</p></li>
<li><p>As of May 2021, CLHEP on macports is not 2.4.4.1, therefore if <strong>Geant4 10.7</strong> is used,
CLHEP should be setup manually.</p></li>
</ul>
</section>
<section id="linux-generally">
<h3>Linux Generally<a class="headerlink" href="#linux-generally" title="Link to this heading"></a></h3>
<p>Install the <a class="reference internal" href="#required-packages"><span class="std std-ref">Requirements &amp; Environment</span></a> preferably with a package manager.</p>
<p>Older versions of Geant4 can be downloaded from their
<a class="reference external" href="http://geant4.web.cern.ch/geant4/support/source_archive.shtml">archive</a> .
For Scientific Linux 6 or modern Linux versions, we recommend the latest version of Geant4.
Note: the required compiler version (GCC 4.9) is more modern than the default one (GCC 4.4) on SL6. You
can check the compiler version with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gcc</span> <span class="o">--</span><span class="n">version</span>
</pre></div>
</div>
</section>
<section id="clhep-installation-guide">
<h3>CLHEP Installation Guide<a class="headerlink" href="#clhep-installation-guide" title="Link to this heading"></a></h3>
<p>If not installed with a package manager (MacPorts, HomeBrew, yum), download CLHEP from the <a class="reference external" href="http://proj-clhep.web.cern.ch/">CLHEP</a> website.</p>
<p>Move and unpack to a suitable place:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">clhep</span><span class="o">-</span><span class="mf">2.3.1.1</span><span class="o">.</span><span class="n">tgz</span>
<span class="n">cd</span> <span class="mf">2.3.1.1</span>
</pre></div>
</div>
<p>Make build directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">build</span>
<span class="n">cd</span> <span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">CLHEP</span>
</pre></div>
</div>
<p>Adapt parameters if needed with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccmake</span> <span class="o">.</span>
</pre></div>
</div>
<p>Make and install:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</section>
<section id="geant4-installation-guide">
<span id="id4"></span><h3>Geant4 Installation Guide<a class="headerlink" href="#geant4-installation-guide" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p><strong>Recommend</strong> using Geant4.10.4.p03, or 10.6.p03, or 10.7</p></li>
<li><p>Do not recommend using Geant4.10.5 and Geant4.10.5.p01</p></li>
</ul>
<p>BDSIM builds with most recent versions of Geant4 (version 4.10 onwards). You can usually
get Geant4 through a package manager such as MacPorts or HomeBrew, but often a manual installation
is more flexible to allow choice of visualiser and use of GDML (necessary for external
geometry). For manual installation, download the latest patch version from the
Geant website. Move and unpack to a suitable place</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xzf</span> <span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
<span class="n">ls</span>
 <span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span>
</pre></div>
</div>
<p>Make a build and installation directory <strong>outside</strong> that directory</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span><span class="o">-</span><span class="n">build</span>
<span class="n">mkdir</span> <span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span><span class="o">-</span><span class="n">install</span>
</pre></div>
</div>
<p>Configure Geant4 using CMake</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span><span class="o">-</span><span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span>
</pre></div>
</div>
<p>At this point it’s useful to define the installation directory for Geant4 by
modifying the CMake configuration as generally described in <a class="reference internal" href="#configuring-bdsim"><span class="std std-ref">Configuring the Build</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccmake</span> <span class="o">.</span>
</pre></div>
</div>
<p>It is useful to change a few options with Geant4 for practical purposes.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/geant4options.png"><img alt="_images/geant4options.png" src="_images/geant4options.png" style="width: 90%;" /></a>
</figure>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>Option</strong></p></td>
<td><p><strong>Description</strong></p></td>
</tr>
<tr class="row-even"><td><p><strong>CMAKE_INSTALL_PREFIX</strong></p></td>
<td><p>Useful to specify a known folder to install to.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEANT4_BUILD_MULTITHREADED</strong></p></td>
<td><p>OFF - BDSIM does not support this yet.</p></td>
</tr>
<tr class="row-even"><td><p><strong>GEANT4_INSTALL_DATA</strong></p></td>
<td><p>ON - otherwise Geant will try to download data dynamically,
as it’s required during the simulation and it may not be
possible to run offline.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEANT4_USE_GDML</strong></p></td>
<td><p>ON - for external geometry import.</p></td>
</tr>
<tr class="row-even"><td><p><strong>GEANT4_USE_OPENGL_X11</strong></p></td>
<td><p>ON - basic visualiser.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEANT4_USE_QT</strong></p></td>
<td><p>ON - the best and most interactive visualiser.
Needs Qt to be installed</p></td>
</tr>
<tr class="row-even"><td><p><strong>GEANT4_USE_SYSTEM_CLHEP</strong></p></td>
<td><p>ON - must be on so both Geant4 and BDSIM use the same CLHEP
library. Therefore, there’s only one random number
generator and simulations have strong reproducibility.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEANT4_USE_SYSTEM_ZLIB</strong></p></td>
<td><p>OFF - easier if we use the Geant4 internal version.</p></td>
</tr>
<tr class="row-even"><td><p><strong>GEANT4_USE_RAYTRACER_X11</strong></p></td>
<td><p>ON - The most accurate visualiser, but relatively slow and
not interactive. Useful for promotional materials.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>GEANT4_USE_XM</strong></p></td>
<td><p>ON - similar to Qt and the one to use if Qt isn’t
available. Needs motif to be installed.</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure <strong>GEANT4_BUILD_MULTITHREADED</strong> is off since this is currently not supported.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CLHEP option is required. The GDML and QT options are strongly recommended. Others
are to the user’s preference.</p>
</div>
<p>Once the installation directory is set, press <code class="docutils literal notranslate"><span class="pre">c</span></code> to run the configuration
process, and when complete, press <code class="docutils literal notranslate"><span class="pre">g</span></code> to generate the build. If <code class="docutils literal notranslate"><span class="pre">g</span></code> is not an
available option, then continue to press <code class="docutils literal notranslate"><span class="pre">c</span></code> until it becomes available. This
typically takes two or three times - it is due to dependencies being dependent on
other dependencies. Geant4 can then
be compiled</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>Note: Geant4 can take around 20 minutes to compile on a typical computer. If your
computer has multiple cores, you can significantly decrease the time required to
compile by using extra cores</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">jN</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">N</span></code> is the number of cores on your computer <a class="footnote-reference brackets" href="#ncoresnote" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Geant4 should
then be installed</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>Note: if you’ve specified the directory to install, you will not need the <code class="docutils literal notranslate"><span class="pre">sudo</span></code>
command. However, if you’ve left the settings as default, it’ll be installed
in a folder that requires <code class="docutils literal notranslate"><span class="pre">sudo</span></code> permissions such as <code class="docutils literal notranslate"><span class="pre">/usr/local/</span></code>.</p>
<p><strong>IMPORTANT</strong> - you should source the Geant4 environment each time before running
BDSIM, as this is required for the physics models of Geant4.  This can be done using</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">geant4</span><span class="mf">.10.6</span><span class="o">.</span><span class="n">p03</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">geant4</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>It may be useful to add this command to your <code class="docutils literal notranslate"><span class="pre">.bashrc</span></code> or profile script.</p>
</section>
</section>
<section id="compiling-bdsim">
<span id="installation-building"></span><h2>Compiling BDSIM<a class="headerlink" href="#compiling-bdsim" title="Link to this heading"></a></h2>
<p>Once ready, make a directory <strong>outside</strong> the BDSIM source directory to build
BDSIM in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span>
 <span class="n">bdsim</span>
<span class="n">mkdir</span> <span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">ls</span>
 <span class="n">bdsim</span> <span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
</pre></div>
</div>
<p>It is important that the build directory be outside the source directory, otherwise
trouble may be encountered when receiving further updates from the git repository.
From this directory use the following CMake command to configure the BDSIM
installation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span>
</pre></div>
</div>
<p>This typically produces the following output, which is slightly different on each computer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>-- The C compiler identification is AppleClang 12.0.5.12050022
-- The CXX compiler identification is AppleClang 12.0.5.12050022
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Check for working C compiler: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/cc - skipped
-- Detecting C compile features
-- Detecting C compile features - done
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Check for working CXX compiler: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++ - skipped
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Configuring BDSIM 1.6.0
-- Installation prefix: /usr/local
-- Build Type RelWithDebInfo
-- Compiler fully supports C++17 and prior versions
-- Looking for CLHEP
-- Found CLHEP 2.4.4.1 in /Users/nevay/physics/packages/clhep-2.4.4.1-install/lib/CLHEP-2.4.4.1/../../include
-- Looking for ROOT...
-- ROOT search hint from $ROOTSYS: /opt/local
-- Using root-config: /opt/local/bin/root-config
-- Found ROOT 6.24/00 in /opt/local/libexec/root6
-- ROOT compiled with cxx17 feature -&gt; changing to C++17 for BDSIM
-- GDML support ON
-- Looking for pthread.h
-- Looking for pthread.h - found
-- Performing Test CMAKE_HAVE_LIBC_PTHREAD
-- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Success
-- Found Threads: TRUE
-- Geant4 Use File: /Users/nevay/physics/packages/geant4-jai/geant4-10.7-jaidev-install/lib/Geant4-10.7.1/UseGeant4.cmake
-- Geant4 Definitions: -DG4UI_USE_TCSH;-DG4INTY_USE_XT;-DG4VIS_USE_RAYTRACERX;-DG4INTY_USE_QT;-DG4UI_USE_QT;-DG4VIS_USE_OPENGLQT;-DG4VIS_USE_OPENGLX;-DG4VIS_USE_OPENGL;-DG4VIS_USE_QT3D
-- G4_VERSION: 10.7.1
-- Found Doxygen: /opt/local/bin/doxygen (found version &quot;1.9.1&quot;) found components: doxygen dot
-- Found BISON: /opt/local/bin/bison (found suitable version &quot;3.7.6&quot;, minimum required is &quot;2.4&quot;)
-- Found FLEX: /opt/local/bin/flex (found version &quot;2.6.4&quot;)
-- Performing Test COMPILER_HAS_HIDDEN_VISIBILITY
-- Performing Test COMPILER_HAS_HIDDEN_VISIBILITY - Success
-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY
-- Performing Test COMPILER_HAS_HIDDEN_INLINE_VISIBILITY - Success
-- Performing Test COMPILER_HAS_DEPRECATED_ATTR
-- Performing Test COMPILER_HAS_DEPRECATED_ATTR - Success
-- Looking for zlib
-- Using Geant4 built in zlib
-- Copying example directory
-- Found Sphinx: /opt/local/bin/sphinx-build
-- Found PY_sphinx_rtd_theme: /opt/local/Library/Frameworks/Python.framework/Versions/3.9/lib/python3.9/site-packages/sphinx_rtd_theme
-- Configuring done
-- Generating done
-- Build files have been written to: /Users/nevay/physics/reps/bdsim-test-build
</pre></div>
</div>
<p>CMake will search your system for the required dependencies. In the above example, this
proceeded without any errors. In the case where a required dependency cannot be found,
an error will be shown and CMake will stop. Please see <a class="reference internal" href="#configuring-bdsim"><span class="std std-ref">Configuring the Build</span></a> for
further details on how to fix this and further configure the BDSIM installation.</p>
<p>You can then compile BDSIM with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
</pre></div>
</div>
<p>BDSIM can then be installed (default directory /usr/local) for access from anywhere
on the system with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>To change the installation directory, see <a class="reference internal" href="#configuring-bdsim"><span class="std std-ref">Configuring the Build</span></a>.
From any directory on your computer, <code class="docutils literal notranslate"><span class="pre">bdsim</span></code> should be available.</p>
<p>At this point, BDSIM itself will work, but more environmental variables must be
set to use the analysis tools (this is a requirement of ROOT). These can be set
by sourcing the bdsim.sh shell script in the installation directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">&lt;</span><span class="n">bdsim</span><span class="o">-</span><span class="n">install</span><span class="o">-</span><span class="nb">dir</span><span class="o">&gt;/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bdsim</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>This can be added to your <code class="code docutils literal notranslate"><span class="pre">.profile</span></code> or <code class="code docutils literal notranslate"><span class="pre">.bashrc</span></code> file. The user
should adapt this if they use a C-shell.</p>
<ul class="simple">
<li><p>Re-source your profile (or restart the terminal).</p></li>
<li><p>You should be able to execute <code class="code docutils literal notranslate"><span class="pre">bdsim</span> <span class="pre">--help</span></code> or <code class="code docutils literal notranslate"><span class="pre">rebdsim</span></code></p></li>
</ul>
<figure class="align-center">
<a class="reference internal image-reference" href="_images/rebdsim_execution.png"><img alt="_images/rebdsim_execution.png" src="_images/rebdsim_execution.png" style="width: 100%;" /></a>
</figure>
<p>If the analysis will be regularly used interactively, it is worth automating the library
loading in root by finding and editing the <code class="code docutils literal notranslate"><span class="pre">rootlogon.C</span></code> in your
<code class="code docutils literal notranslate"><span class="pre">&lt;root-install-dir&gt;/macros/</span></code> directory.  Example text would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Loading rebdsim libraries&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="n">gSystem</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="s2">&quot;librebdsimLib&quot;</span><span class="p">);</span>
<span class="n">gSystem</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="s2">&quot;libbdsimRootEvent&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The file extension is omitted on purpose.</p>
</div>
<p>The absolute path is not necessary, as the above environmental variables are used by ROOT
to find the library.</p>
<p>From the build directory you can verify your installation using a series of tests
included with BDSIM (excluding long running tests):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ctest</span> <span class="o">-</span><span class="n">LE</span> <span class="n">LONG</span>
</pre></div>
</div>
<section id="configuring-the-build">
<span id="configuring-bdsim"></span><h3>Configuring the Build<a class="headerlink" href="#configuring-the-build" title="Link to this heading"></a></h3>
<p>To either enter paths to dependencies manually, or edit the configuration, the following
command will give you and interface to CMake (from the <code class="code docutils literal notranslate"><span class="pre">bdsim-build</span></code> directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ccmake</span> <span class="o">.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/cmake_screenshot.png"><img alt="_images/cmake_screenshot.png" class="align-center" src="_images/cmake_screenshot.png" style="width: 100%;" /></a>
<p>You can then use <strong>up</strong> and <strong>down</strong> arrows to select the desired parameter and
<strong>enter</strong> to edit it. If the parameter is a path, press <strong>enter</strong> again after
entering the path to confirm.</p>
<p>Once the parameter has been edited, you can proceed by pressing <strong>c</strong> to run
the configuration and if successful, follow this by <strong>g</strong> to generate the
build. After configuring the installation, you should run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the default installation directory is used, you may need to use <code class="code docutils literal notranslate"><span class="pre">sudo</span></code> before
this command. You can change the installation directory in the above <strong>ccmake</strong>
configuration to one that won’t require the <code class="code docutils literal notranslate"><span class="pre">sudo</span></code> command. The variable
<code class="code docutils literal notranslate"><span class="pre">CMAKE_INSTALL_PREFIX</span></code> should be changed.</p>
</div>
<section id="optional-configuration-options">
<span id="installation-bdsim-config-options"></span><h4>Optional Configuration Options<a class="headerlink" href="#optional-configuration-options" title="Link to this heading"></a></h4>
<p>BDSIM has a few optional configuration options. These can be specified with a value when
running CMake by prefixing them with “-D”. The following options are available.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>USE_AWAKE</strong></p></td>
<td><p>Use AWAKE model components. (default OFF)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_BOOST</strong></p></td>
<td><p>Whether to link againt Boost library. (default OFF)
This options enables the differential flux scoring feature
available using the scorer type cellflux4d.</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_CUSTOM_CHANNELLING</strong></p></td>
<td><p>Use RHUL custom crystal channelling package in Geant4. Only
if you have this package patched onto Geant4.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_EVENT_DISPLAY</strong></p></td>
<td><p>Turn on or off event display. Requires ROOT EVE libraries
and is an unmaintained work in progress. (default OFF)</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_GDML</strong></p></td>
<td><p>Control over use of GDML. On if Geant4 has GDML support.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_GEANT4_EMD_ID</strong></p></td>
<td><p>If using RHUL Geant4 with EMD process with its own ID turn
this on to uniquely identify that process in cross-section
biasing. (default OFF)</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_GZSTREAM</strong></p></td>
<td><p>Control over using GZip library. (default ON)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_HEPMC3</strong></p></td>
<td><p>Whether to link against HepMC3. (default OFF)</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_HEPMC3_ROOTIO</strong></p></td>
<td><p>Whether HEPMC3 was built with ROOTIO on. (default OFF)</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_ROOT_DOUBLE_OUTPUT</strong></p></td>
<td><p>Whether to use double precision for all output. Note this
will roughly double the size of the output files. Useful
only for precision tracking tests using samplers. Note,
data generated with this build cannot be used with a
normal build with this turned off. (default OFF)</p></td>
</tr>
<tr class="row-even"><td><p><strong>BDSIM_BUILD_STATIC_LIBS</strong></p></td>
<td><p>Whether to build the static library in addition to the main
shared one. Note, currently the executables will only ever
be linked to the shared libraries - work in progress.
(default OFF)</p></td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><p>Booleans can be specified with OFF or ON.</p></li>
</ul>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span> <span class="o">-</span><span class="n">DUSE_HEPMC3</span><span class="o">=</span><span class="n">ON</span>
</pre></div>
</div>
<ul class="simple">
<li><p>With HepMC 3.1.1 we find a compiler warning about an unused variable. This is harmless and on the
HepMC3 side that we can’t change.</p></li>
</ul>
</section>
<section id="giving-cmake-hints-for-packages">
<h4>Giving CMake Hints for Packages<a class="headerlink" href="#giving-cmake-hints-for-packages" title="Link to this heading"></a></h4>
<p>When configuring BDSIM, or any CMake package, we can give CMake hints on where to look for
packages. These can be given through the command line options at configuration time with
the general syntax <code class="code docutils literal notranslate"><span class="pre">-D&lt;package-name&gt;_DIR=/path/to/package/install-prefix</span></code>. For example,
the following ones may be useful with BDSIM.</p>
<ul class="simple">
<li><p><code class="code docutils literal notranslate"><span class="pre">-DHepMC3_DIR</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">-DGeant4_DIR</span></code></p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">-DCLHEP_DIR</span></code></p></li>
</ul>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span> <span class="o">-</span><span class="n">DUSE_HEPMC3</span><span class="o">=</span><span class="n">ON</span> <span class="o">-</span><span class="n">DHepMC3_DIR</span><span class="o">=/</span><span class="n">opt</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">HepMC3</span><span class="o">/</span><span class="n">cmake</span>
</pre></div>
</div>
</section>
<section id="specifying-a-root-installation">
<h4>Specifying a ROOT Installation<a class="headerlink" href="#specifying-a-root-installation" title="Link to this heading"></a></h4>
<p>To specify a ROOT installation it is best to have source the <code class="code docutils literal notranslate"><span class="pre">&lt;root-install-prefix&gt;/bin/thisroot.sh</span></code>.
This will set the environmental variable ROOTSYS. BDSIM will look for the program <code class="code docutils literal notranslate"><span class="pre">root-config</span></code>
in the prefix given by ROOTSYS in the environment then use the ROOT installation according to that
root-config.</p>
<p>This can be overridden by specifying <code class="code docutils literal notranslate"><span class="pre">-DROOT_CONFIG_EXECUTABLE=/path/to/root-config</span></code> when configuring
BDSIM.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">cd</span> <span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span> <span class="o">-</span><span class="n">DROOT_CONFIG_EXECUTABLE</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">nevay</span><span class="o">/</span><span class="n">physics</span><span class="o">/</span><span class="n">packages</span><span class="o">/</span><span class="n">root</span><span class="o">-</span><span class="mf">6.18.04</span><span class="o">-</span><span class="n">install</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">root</span><span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
<p>The CMake configuration print out will show which ROOT installation is being used.</p>
</section>
<section id="advanced-configuration-options">
<h4>Advanced Configuration Options<a class="headerlink" href="#advanced-configuration-options" title="Link to this heading"></a></h4>
<p>These options are for developers of BDSIM. These may change without notice or cause unintended
effects.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Option</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>BDSIM_BUILD_TEST_PROGRAMS</strong></p></td>
<td><p>Whether to build a set of test executable programs. For
developers. Also defines extra CTest tests. Default off.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>BDSIM_FINAL_INSTALL_DIR</strong></p></td>
<td><p>This path if set will used as the first vis macro path to
be searched. Should be up to and including “bdsim”. Used in
the case of a CVMFS build where the build is relocated.</p></td>
</tr>
<tr class="row-even"><td><p><strong>BDSIM_GENERATE_REGRESSION_DATA</strong></p></td>
<td><p>Whether to generate regression test data from the tests.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>BDSIM_REGRESSION_PREFIX</strong></p></td>
<td><p>Name prefix for all output files from regression test data.</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_DEBUG_NAVIGATION</strong></p></td>
<td><p>Extra print out (a lot) to understand navigation through
the geometry.</p></td>
</tr>
<tr class="row-odd"><td><p><strong>USE_FIELD_DOUBLE_PRECISION</strong></p></td>
<td><p>Use double precision for all field maps.</p></td>
</tr>
<tr class="row-even"><td><p><strong>USE_SIXTRACK_LINK</strong></p></td>
<td><p>Use experimental sixtrack link interface. Affects output.
(default OFF)</p></td>
</tr>
</tbody>
</table>
</section>
<section id="environmental-variables">
<span id="installation-environmental-variables"></span><h4>Environmental Variables<a class="headerlink" href="#environmental-variables" title="Link to this heading"></a></h4>
<p>Some variables are required by ROOT to access the BDSIM classes but not by BDSIM itself.
These variables are set in the <code class="code docutils literal notranslate"><span class="pre">&lt;bdsim-install-dir&gt;/bin/bdsim.sh</span></code> provided shell script.</p>
<ul class="simple">
<li><p>We recommend adding this to your terminal profile: <code class="code docutils literal notranslate"><span class="pre">source</span> <span class="pre">&lt;bdsim-install-dir&gt;/bin/bdsim.sh</span></code></p></li>
</ul>
</section>
</section>
</section>
<section id="python-utilities">
<span id="setup-python-utilities"></span><h2>Python Utilities<a class="headerlink" href="#python-utilities" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Quick setup: simply run <code class="docutils literal notranslate"><span class="pre">source</span> <span class="pre">pyutils.sh</span></code> from the <code class="docutils literal notranslate"><span class="pre">bdsim/utils</span></code> directory.</p></li>
</ul>
<p>The BDSIM Python utilities (<cite>pytransport</cite>, <cite>pymad8</cite>, <cite>pymadx</cite>, and <cite>pybdsim</cite>) all exist in
separate git repositories in the following locations:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://bitbucket.org/jairhul/pybdsim">https://bitbucket.org/jairhul/pybdsim</a></p></li>
<li><p><a class="reference external" href="https://bitbucket.org/jairhul/pymadx">https://bitbucket.org/jairhul/pymadx</a></p></li>
<li><p><a class="reference external" href="https://bitbucket.org/jairhul/pymad8">https://bitbucket.org/jairhul/pymad8</a></p></li>
<li><p><a class="reference external" href="https://bitbucket.org/jairhul/pytransport">https://bitbucket.org/jairhul/pytransport</a></p></li>
</ul>
<p>These should be downloaded and installed <strong>using pip</strong> by default for users.</p>
<p>If it is intended to edit these packages or add to them (always welcome!), then it
is preferable to clone the git repository and use the commands in the Makefile in each
one, such as <code class="code docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">--editable</span> <span class="pre">.</span></code> that allows the package to be registered
to your Python installation but it gets the files freshly each time from the git
repository folder upon restarting Python.</p>
<p>To switch between these modes, simply uninstall the utilities, then reinstall.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">uninstall</span> <span class="n">pybdsim</span>
<span class="n">pip</span> <span class="n">uninstall</span> <span class="n">pymadx</span>
<span class="n">pip</span> <span class="n">uninstall</span> <span class="n">pymad8</span>
<span class="n">pip</span> <span class="n">uninstall</span> <span class="n">pytransport</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>pybdsim</cite> depends on <cite>pymadx</cite>, <cite>pymad8</cite>, and <cite>pytransport</cite>, so if these are
not already available it will get them from PyPi on the internet. To use
multiple develop versions of these from local git repositories, install in
the order: <cite>pytransport</cite>, <cite>pymad8</cite>, <cite>pymadx</cite>, then <cite>pybdsim</cite>.</p>
</div>
<section id="updating-the-python-utilities">
<h3>Updating the Python Utilities<a class="headerlink" href="#updating-the-python-utilities" title="Link to this heading"></a></h3>
<p>With pip you can see if packages are outdated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="nb">list</span> <span class="o">-</span><span class="n">o</span>
</pre></div>
</div>
<p>If you see pybdsim as an outdated package, you can do the following to update it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">--</span><span class="n">upgrade</span> <span class="n">pybdsim</span>
</pre></div>
</div>
</section>
</section>
<section id="upgrading-bdsim">
<h2>Upgrading BDSIM<a class="headerlink" href="#upgrading-bdsim" title="Link to this heading"></a></h2>
<p>To update BDSIM when a new release is made, we recommend receiving updates through the
git repository. To receive the latest version of the software, the user must ‘pull’ the
changes from the git repository and then update the build.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Assuming you have a BDSIM source directory (“bdsim”) that is a clone of the git repository
and a separate build directory (“bdsim-build”) that is <em>outside</em> the source directory.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">bdsim</span>
<span class="n">git</span> <span class="n">pull</span>
</pre></div>
</div>
<p>You then have two options: 1) make a clean build or 2) update the current build. The first option
is generally more robust and we recommend that. Both are described for completeness.</p>
<section id="clean-build">
<h3>Clean Build<a class="headerlink" href="#clean-build" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="o">*</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span>
<span class="c1"># do any configuration steps in ccmake .</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j4</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>If custom locations for various dependencies had to be specified with CMake for the initial
configuration and compilation of BDSIM, these will have to be repeated (see
<a class="reference internal" href="#configuring-bdsim"><span class="std std-ref">Configuring the Build</span></a> for details on using ccmake to do this).</p>
</section>
<section id="updated-existing-build">
<h3>Updated Existing Build<a class="headerlink" href="#updated-existing-build" title="Link to this heading"></a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">../</span><span class="n">bdsim</span><span class="o">-</span><span class="n">build</span>
<span class="n">cmake</span> <span class="o">../</span><span class="n">bdsim</span>
<span class="n">make</span> <span class="o">-</span><span class="n">j4</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
</section>
</section>
<section id="troubleshooting">
<span id="id6"></span><h2>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Link to this heading"></a></h2>
<p>Below is a list of possible encountered problems. If you experience problems beyond these,
please contact us (see <a class="reference internal" href="support.html#support-section"><span class="std std-ref">Support</span></a>).</p>
<ol class="arabic">
<li><p>Mac OSX Mojave - OpenGL visualisations in Geant4 appear to be missing in a grey
screen or worse, bits of the interface double size. The user must use Qt 5.12.1
or greater for these issues to be resolved. This issue is documented here:
<a class="reference external" href="https://bugzilla-geant4.kek.jp/show_bug.cgi?id=2104">https://bugzilla-geant4.kek.jp/show_bug.cgi?id=2104</a></p></li>
<li><p>Visualisation does not work:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;parameter value is not listed in the candidate List.&quot;</span>
</pre></div>
</div>
<p>Check which graphics systems BDSIM has available. This is shown in the terminal when
you run BDSIM</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">You</span> <span class="n">have</span> <span class="n">successfully</span> <span class="n">registered</span> <span class="n">the</span> <span class="n">following</span> <span class="n">graphics</span> <span class="n">systems</span><span class="o">.</span>
<span class="n">Current</span> <span class="n">available</span> <span class="n">graphics</span> <span class="n">systems</span> <span class="n">are</span><span class="p">:</span>
<span class="n">ASCIITree</span> <span class="p">(</span><span class="n">ATree</span><span class="p">)</span>
<span class="n">DAWNFILE</span> <span class="p">(</span><span class="n">DAWNFILE</span><span class="p">)</span>
<span class="n">G4HepRep</span> <span class="p">(</span><span class="n">HepRepXML</span><span class="p">)</span>
<span class="n">G4HepRepFile</span> <span class="p">(</span><span class="n">HepRepFile</span><span class="p">)</span>
<span class="n">OpenGLImmediateQt</span> <span class="p">(</span><span class="n">OGLI</span><span class="p">,</span> <span class="n">OGLIQt</span><span class="p">)</span>
<span class="n">OpenGLImmediateX</span> <span class="p">(</span><span class="n">OGLIX</span><span class="p">)</span>
<span class="n">OpenGLImmediateXm</span> <span class="p">(</span><span class="n">OGLIXm</span><span class="p">,</span> <span class="n">OGLI_FALLBACK</span><span class="p">,</span> <span class="n">OGLIQt_FALLBACK</span><span class="p">)</span>
<span class="n">OpenGLStoredQt</span> <span class="p">(</span><span class="n">OGL</span><span class="p">,</span> <span class="n">OGLS</span><span class="p">,</span> <span class="n">OGLSQt</span><span class="p">)</span>
<span class="n">OpenGLStoredX</span> <span class="p">(</span><span class="n">OGLSX</span><span class="p">)</span>
<span class="n">OpenGLStoredXm</span> <span class="p">(</span><span class="n">OGLSXm</span><span class="p">,</span> <span class="n">OGL_FALLBACK</span><span class="p">,</span> <span class="n">OGLS_FALLBACK</span><span class="p">,</span> <span class="n">OGLSQt_FALLBACK</span><span class="p">)</span>
<span class="n">RayTracer</span> <span class="p">(</span><span class="n">RayTracer</span><span class="p">)</span>
<span class="n">RayTracerX</span> <span class="p">(</span><span class="n">RayTracerX</span><span class="p">)</span>
<span class="n">VRML1FILE</span> <span class="p">(</span><span class="n">VRML1FILE</span><span class="p">)</span>
<span class="n">VRML2FILE</span> <span class="p">(</span><span class="n">VRML2FILE</span><span class="p">)</span>
<span class="n">gMocrenFile</span> <span class="p">(</span><span class="n">gMocrenFile</span><span class="p">)</span>
</pre></div>
</div>
<p>If your favourite is not there check that Geant4 is correctly compiled with that graphics system.
You will have to reconfigure Geant4 and install any necessary libraries (such as Qt or XMotif), then
recompile Geant4, then recompile bdsim.</p>
</li>
<li><p>Huge print out and failure when trying to load data in Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">import</span> <span class="nn">pybdsim</span>
<span class="n">d</span> <span class="o">=</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">d</span> <span class="o">=</span> <span class="n">pybdsim</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s2">&quot;run1.root&quot;</span><span class="p">)</span>

<span class="n">Error</span> <span class="ow">in</span> <span class="n">cling</span><span class="p">::</span><span class="n">AutoloadingVisitor</span><span class="p">::</span><span class="n">InsertIntoAutoloadingState</span><span class="p">:</span>
<span class="n">Missing</span> <span class="n">FileEntry</span> <span class="k">for</span> <span class="o">../</span><span class="n">parser</span><span class="o">/</span><span class="n">beamBase</span><span class="o">.</span><span class="n">h</span>
<span class="n">requested</span> <span class="n">to</span> <span class="n">autoload</span> <span class="nb">type</span> <span class="n">GMAD</span><span class="p">::</span><span class="n">BeamBase</span>
<span class="n">Error</span> <span class="ow">in</span> <span class="n">cling</span><span class="p">::</span><span class="n">AutoloadingVisitor</span><span class="p">::</span><span class="n">InsertIntoAutoloadingState</span><span class="p">:</span>
<span class="n">Missing</span> <span class="n">FileEntry</span> <span class="k">for</span> <span class="o">../</span><span class="n">parser</span><span class="o">/</span><span class="n">optionsBase</span><span class="o">.</span><span class="n">h</span>
<span class="n">requested</span> <span class="n">to</span> <span class="n">autoload</span> <span class="nb">type</span> <span class="n">GMAD</span><span class="p">::</span><span class="n">OptionsBase</span>
<span class="n">HeaderDict</span> <span class="n">dictionary</span> <span class="n">payload</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">10</span><span class="p">:</span> <span class="n">fatal</span> <span class="n">error</span><span class="p">:</span> <span class="s1">&#39;BDSOutputROOTEventHeader.hh&#39;</span> <span class="n">file</span> <span class="ow">not</span> <span class="n">found</span>
<span class="c1">#include &quot;BDSOutputROOTEventHeader.hh&quot;</span>
          <span class="o">^~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="n">Error</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">TInterpreter</span><span class="p">::</span><span class="n">AutoParse</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">Error</span> <span class="n">parsing</span> <span class="n">payload</span> <span class="n">code</span> <span class="k">for</span> <span class="k">class</span> <span class="nc">Header</span> <span class="k">with</span> <span class="n">content</span><span class="p">:</span>

<span class="c1">#line 1 &quot;HeaderDict dictionary payload&quot;</span>

<span class="c1">#ifndef G__VECTOR_HAS_CLASS_ITERATOR</span>
  <span class="c1">#define G__VECTOR_HAS_CLASS_ITERATOR 1</span>
<span class="c1">#endif</span>
<span class="c1">#ifndef __ROOTBUILD__</span>
  <span class="c1">#define __ROOTBUILD__ 1</span>
<span class="c1">#endif</span>

<span class="c1">#define _BACKWARD_BACKWARD_WARNING_H</span>
<span class="o">/*</span>
<span class="n">Beam</span> <span class="n">Delivery</span> <span class="n">Simulation</span> <span class="p">(</span><span class="n">BDSIM</span><span class="p">)</span> <span class="n">Copyright</span> <span class="p">(</span><span class="n">C</span><span class="p">)</span> <span class="n">Royal</span> <span class="n">Holloway</span><span class="p">,</span>
<span class="n">University</span> <span class="n">of</span> <span class="n">London</span> <span class="mi">2001</span> <span class="o">-</span> <span class="mf">2020.</span>

<span class="n">This</span> <span class="n">file</span> <span class="ow">is</span> <span class="n">part</span> <span class="n">of</span> <span class="n">BDSIM</span><span class="o">.</span>

<span class="n">BDSIM</span> <span class="ow">is</span> <span class="n">free</span> <span class="n">software</span><span class="p">:</span> <span class="n">you</span> <span class="n">can</span> <span class="n">redistribute</span> <span class="n">it</span> <span class="ow">and</span><span class="o">/</span><span class="ow">or</span> <span class="n">modify</span>
<span class="n">it</span> <span class="n">under</span> <span class="n">the</span> <span class="n">terms</span> <span class="n">of</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span> <span class="k">as</span> <span class="n">published</span>
<span class="n">by</span> <span class="n">the</span> <span class="n">Free</span> <span class="n">Software</span> <span class="n">Foundation</span> <span class="n">version</span> <span class="mi">3</span> <span class="n">of</span> <span class="n">the</span> <span class="n">License</span><span class="o">.</span>

<span class="n">BDSIM</span> <span class="ow">is</span> <span class="n">distributed</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">hope</span> <span class="n">that</span> <span class="n">it</span> <span class="n">will</span> <span class="n">be</span> <span class="n">useful</span><span class="p">,</span> <span class="n">but</span>
<span class="n">WITHOUT</span> <span class="n">ANY</span> <span class="n">WARRANTY</span><span class="p">;</span> <span class="n">without</span> <span class="n">even</span> <span class="n">the</span> <span class="n">implied</span> <span class="n">warranty</span> <span class="n">of</span>
<span class="n">MERCHANTABILITY</span> <span class="ow">or</span> <span class="n">FITNESS</span> <span class="n">FOR</span> <span class="n">A</span> <span class="n">PARTICULAR</span> <span class="n">PURPOSE</span><span class="o">.</span>  <span class="n">See</span> <span class="n">the</span>
<span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span> <span class="k">for</span> <span class="n">more</span> <span class="n">details</span><span class="o">.</span>

<span class="n">You</span> <span class="n">should</span> <span class="n">have</span> <span class="n">received</span> <span class="n">a</span> <span class="n">copy</span> <span class="n">of</span> <span class="n">the</span> <span class="n">GNU</span> <span class="n">General</span> <span class="n">Public</span> <span class="n">License</span>
<span class="n">along</span> <span class="k">with</span> <span class="n">BDSIM</span><span class="o">.</span>  <span class="n">If</span> <span class="ow">not</span><span class="p">,</span> <span class="n">see</span> <span class="o">&lt;</span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">gnu</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">licenses</span><span class="o">/&gt;.</span>
<span class="o">*/</span>
<span class="c1">#ifndef ANALYSISHEADER_H</span>
<span class="c1">#define ANALYSISHEADER_H</span>

<span class="c1">#include &quot;TROOT.h&quot;</span>

<span class="c1">#include &quot;BDSOutputROOTEventHeader.hh&quot;</span>

<span class="c1">#include &quot;RebdsimTypes.hh&quot;</span>

<span class="k">class</span> <span class="nc">TTree</span><span class="p">;</span>

<span class="o">/**</span>
 <span class="o">*</span> <span class="nd">@brief</span> <span class="n">Options</span> <span class="n">loader</span><span class="o">.</span>
 <span class="o">*</span>
 <span class="o">*</span> <span class="nd">@author</span> <span class="n">Laurie</span> <span class="n">Nevay</span><span class="o">.</span>
 <span class="o">*/</span>

<span class="k">class</span> <span class="nc">Header</span>
<span class="p">{</span>
<span class="n">public</span><span class="p">:</span>
  <span class="n">Header</span><span class="p">();</span>
  <span class="n">Header</span><span class="p">(</span><span class="nb">bool</span> <span class="n">debugIn</span><span class="p">);</span>
  <span class="n">virtual</span> <span class="o">~</span><span class="n">Header</span><span class="p">();</span>

  <span class="o">///</span> <span class="n">Set</span> <span class="n">the</span> <span class="n">branch</span> <span class="n">addresses</span> <span class="n">to</span> <span class="n">address</span> <span class="n">the</span> <span class="n">contents</span> <span class="n">of</span> <span class="n">the</span> <span class="n">file</span><span class="o">.</span>
  <span class="n">void</span> <span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">TTree</span><span class="o">*</span> <span class="n">t</span><span class="p">);</span>

  <span class="o">///</span> <span class="n">Member</span> <span class="n">that</span> <span class="n">ROOT</span> <span class="n">can</span> <span class="nb">map</span> <span class="n">file</span> <span class="n">data</span> <span class="n">to</span> <span class="n">locally</span><span class="o">.</span>
  <span class="n">BDSOutputROOTEventHeader</span><span class="o">*</span> <span class="n">header</span><span class="p">;</span>

<span class="n">private</span><span class="p">:</span>
  <span class="nb">bool</span> <span class="n">debug</span><span class="p">;</span>

  <span class="n">ClassDef</span><span class="p">(</span><span class="n">Header</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">#endif</span>

<span class="c1">#undef  _BACKWARD_BACKWARD_WARNING_H</span>

<span class="n">Error</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">TClass</span><span class="p">::</span><span class="n">LoadClassInfo</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">no</span> <span class="n">interpreter</span> <span class="n">information</span> <span class="k">for</span> <span class="k">class</span> <span class="nc">Header</span> <span class="ow">is</span> <span class="n">available</span> <span class="n">even</span> <span class="n">though</span> <span class="n">it</span> <span class="n">has</span> <span class="n">a</span> <span class="n">TClass</span> <span class="n">initialization</span> <span class="n">routine</span><span class="o">.</span>
<span class="n">Error</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">TClass</span><span class="p">::</span><span class="n">LoadClassInfo</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">no</span> <span class="n">interpreter</span> <span class="n">information</span> <span class="k">for</span> <span class="k">class</span> <span class="nc">Header</span> <span class="ow">is</span> <span class="n">available</span> <span class="n">even</span> <span class="n">though</span> <span class="n">it</span> <span class="n">has</span> <span class="n">a</span> <span class="n">TClass</span> <span class="n">initialization</span> <span class="n">routine</span><span class="o">.</span>
<span class="o">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span>                              <span class="n">Traceback</span> <span class="p">(</span><span class="n">most</span> <span class="n">recent</span> <span class="n">call</span> <span class="n">last</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">ab00b7718588</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span><span class="p">()</span>
<span class="o">----&gt;</span> <span class="mi">1</span> <span class="n">d</span> <span class="o">=</span> <span class="n">pybdsim</span><span class="o">.</span><span class="n">Data</span><span class="o">.</span><span class="n">Load</span><span class="p">(</span><span class="s2">&quot;run1.root&quot;</span><span class="p">)</span>

<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">nevay</span><span class="o">/</span><span class="n">physics</span><span class="o">/</span><span class="n">reps</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">Data</span><span class="o">.</span><span class="n">pyc</span> <span class="ow">in</span> <span class="n">Load</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
     <span class="mi">60</span>         <span class="k">return</span> <span class="n">_LoadAscii</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
     <span class="mi">61</span>     <span class="k">elif</span> <span class="n">extension</span> <span class="o">==</span> <span class="s1">&#39;root&#39;</span><span class="p">:</span>
<span class="o">---&gt;</span> <span class="mi">62</span>         <span class="k">return</span> <span class="n">_LoadRoot</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
     <span class="mi">63</span>         <span class="k">try</span><span class="p">:</span>
     <span class="mi">64</span>             <span class="k">return</span> <span class="n">_LoadRoot</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">nevay</span><span class="o">/</span><span class="n">physics</span><span class="o">/</span><span class="n">reps</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">Data</span><span class="o">.</span><span class="n">pyc</span> <span class="ow">in</span> <span class="n">_LoadRoot</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="mi">149</span>     <span class="n">LoadROOTLibraries</span><span class="p">()</span>
    <span class="mi">150</span>
<span class="o">--&gt;</span> <span class="mi">151</span>     <span class="n">fileType</span> <span class="o">=</span> <span class="n">_ROOTFileType</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span> <span class="c1">#throws warning if not a bdsim file</span>
    <span class="mi">152</span>
    <span class="mi">153</span>     <span class="k">if</span> <span class="n">fileType</span> <span class="o">==</span> <span class="s2">&quot;BDSIM&quot;</span><span class="p">:</span>

<span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">nevay</span><span class="o">/</span><span class="n">physics</span><span class="o">/</span><span class="n">reps</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">pybdsim</span><span class="o">/</span><span class="n">Data</span><span class="o">.</span><span class="n">pyc</span> <span class="ow">in</span> <span class="n">_ROOTFileType</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
    <span class="mi">133</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">htree</span><span class="p">:</span>
    <span class="mi">134</span>         <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s2">&quot;ROOT file </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> is not a BDSIM one&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileToCheck</span><span class="p">))</span>
<span class="o">--&gt;</span> <span class="mi">135</span>     <span class="n">h</span> <span class="o">=</span> <span class="n">_ROOT</span><span class="o">.</span><span class="n">Header</span><span class="p">()</span>
    <span class="mi">136</span>     <span class="n">h</span><span class="o">.</span><span class="n">SetBranchAddress</span><span class="p">(</span><span class="n">htree</span><span class="p">)</span>
    <span class="mi">137</span>     <span class="n">htree</span><span class="o">.</span><span class="n">GetEntry</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="ne">RuntimeError</span><span class="p">:</span> <span class="n">Header</span><span class="p">::</span><span class="n">Header</span><span class="p">()</span> <span class="o">=&gt;</span>
    <span class="n">could</span> <span class="ow">not</span> <span class="n">resolve</span> <span class="p">::()</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
</pre></div>
</div>
</li>
</ol>
<p>In this case, neither ROOT_INCLUDE_PATH or (DY)LD_LIBRARY_PATH environmental variables have been
set. See <a class="reference internal" href="#installation-building"><span class="std std-ref">Compiling BDSIM</span></a> and <a class="reference internal" href="#installation-environmental-variables"><span class="std std-ref">Environmental Variables</span></a>.</p>
<ol class="arabic" start="4">
<li><p>Error from OpenGL:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">G4OpenGLImmediateX</span><span class="p">::</span><span class="n">CreateViewer</span><span class="p">:</span> <span class="n">error</span> <span class="n">flagged</span> <span class="n">by</span> <span class="n">negative</span> <span class="n">view</span> <span class="nb">id</span> <span class="ow">in</span>
<span class="n">G4OpenGLImmediateXViewer</span> <span class="n">creation</span><span class="o">.</span>
</pre></div>
</div>
<p>Check that your graphics card driver is installed correctly for your memory card
and possibly reinstall them. For Ubuntu for example, run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fglrxinfo</span>
</pre></div>
</div>
<p>If fglrx is installed and working well you should see an output similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">fglrxinfo</span>
<span class="n">display</span><span class="p">:</span> <span class="p">:</span><span class="mi">0</span>  <span class="n">screen</span><span class="p">:</span> <span class="mi">0</span>
<span class="n">OpenGL</span> <span class="n">vendor</span> <span class="n">string</span><span class="p">:</span> <span class="n">Advanced</span> <span class="n">Micro</span> <span class="n">Devices</span><span class="p">,</span> <span class="n">Inc</span><span class="o">.</span>
<span class="n">OpenGL</span> <span class="n">renderer</span> <span class="n">string</span><span class="p">:</span> <span class="n">ATI</span> <span class="n">Radeon</span> <span class="n">HD</span> <span class="mi">4300</span><span class="o">/</span><span class="mi">4500</span> <span class="n">Series</span>
<span class="n">OpenGL</span> <span class="n">version</span> <span class="n">string</span><span class="p">:</span> <span class="mf">3.3.11399</span> <span class="n">Compatibility</span> <span class="n">Profile</span> <span class="n">Context</span>
</pre></div>
</div>
<p>For more info see <a class="reference external" href="https://help.ubuntu.com/community/BinaryDriverHowto/AMD">https://help.ubuntu.com/community/BinaryDriverHowto/AMD</a></p>
</li>
<li><p>Build does not work - GLIBCXX errors, where a message similar to this is shown</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Linking</span> <span class="n">CXX</span> <span class="n">executable</span> <span class="n">bdsim</span>
<span class="o">/</span><span class="n">afs</span><span class="o">/</span><span class="n">cern</span><span class="o">.</span><span class="n">ch</span><span class="o">/</span><span class="n">sw</span><span class="o">/</span><span class="n">lcg</span><span class="o">/</span><span class="n">external</span><span class="o">/</span><span class="n">geant4</span><span class="o">/</span><span class="mf">9.6</span><span class="o">.</span><span class="n">p02</span><span class="o">/</span><span class="n">x86_64</span><span class="o">-</span><span class="n">slc6</span><span class="o">-</span><span class="n">gcc46</span><span class="o">-</span><span class="n">opt</span>
<span class="o">/</span><span class="n">lib64</span><span class="o">/</span><span class="n">libG4analysis</span><span class="o">.</span><span class="n">so</span><span class="p">:</span> <span class="n">undefined</span> <span class="n">reference</span> <span class="n">to</span>
<span class="s1">&#39;std::__detail::_List_node_base::_M_unhook()@GLIBCXX_3.4.15&#39;</span>
</pre></div>
</div>
<p>This means that the compiler version for BDSIM is different from the one used to compile Geant4.
Make sure it is the same compiler version. Remember to start from a clean build directory, otherwise
CMake does <strong>NOT</strong> update the compiler version.</p>
</li>
<li><p>Build does not work - linker errors with xml and zlib like</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/usr/lib/../lib64/libxml2.so: undefined reference to `gzdirect@ZLIB_1.2.2.3&#39;
collect2: error: ld returned 1 exit status
</pre></div>
</div>
<p>This probably means that the xml library is not properly installed. The easiest option may be not to use this part of BDSIM by switching off the CMake variable USE_GDML (in ccmake).</p>
</li>
<li><p>The visualiser starts but there is no 3D model present (BDSIM on CVMFS).</p></li>
</ol>
<p>This problem is encountered when using BDSIM over X11 / XWindows such as from lxplus at CERN
and using the CVMFS installation and using it from a Mac computer. This is due to the X-server
not allowing OpenGL by default (the 3D bit). See <a class="reference internal" href="#mac-xwindows"><span class="std std-ref">XWindows With MacOS</span></a> for the solution.</p>
<p class="rubric">Footnotes</p>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="ncoresnote" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">1</a><span class="fn-bracket">]</span></span>
<p>If your computer supports hyper-threading, you can use twice the number of
cores with the <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-jN</span></code> command (i.e. a computer has 4 cores and supports
hyper-threading, can support up to <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">-j8</span></code>). Exceeding this number will
result in slower than normal compilation.</p>
</aside>
</aside>
</section>
<section id="xwindows-with-macos">
<span id="mac-xwindows"></span><h2>XWindows With MacOS<a class="headerlink" href="#xwindows-with-macos" title="Link to this heading"></a></h2>
<p>If using a Mac computer and intending to use BDSIM via SSH / X-Windows, which may include
using BDSIM via a Docker image, it is possible the display will appear but there will be
no model present and just a <strong>blank white screen</strong>. This is due to the default settings
of XQuartz (the most common Mac X-Windows server) not allowing 3D content (specifically openGL)
over X-Windows by default. This was done for security reasons but since we typically connect
to a ‘window’ via SSH, this is irrelevant.</p>
<p>To fix this, we must change the settings.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These settings apply only for MacOS with XQuartz.</p>
</div>
<ol class="arabic">
<li><p>In a terminal, do the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">defaults</span> <span class="n">write</span> <span class="n">org</span><span class="o">.</span><span class="n">macosforge</span><span class="o">.</span><span class="n">xquartz</span><span class="o">.</span><span class="n">X11</span> <span class="n">enable_iglx</span> <span class="o">-</span><span class="nb">bool</span> <span class="n">true</span>
<span class="n">defaults</span> <span class="n">write</span> <span class="n">org</span><span class="o">.</span><span class="n">xquartz</span><span class="o">.</span><span class="n">X11</span> <span class="n">enable_iglx</span> <span class="o">-</span><span class="nb">bool</span> <span class="n">true</span>
</pre></div>
</div>
<p>which enables <em>indirect openGL over X</em>.</p>
</li>
<li><p>Edit the X11 startup script to include the <code class="code docutils literal notranslate"><span class="pre">defaultserverargs=&quot;+iglx&quot;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">emacs</span> <span class="o">-</span><span class="n">nw</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">X11</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">startx</span>
</pre></div>
</div>
</li>
</ol>
<p>Around line 58 we find the argument and edit it.</p>
<figure class="align-center" id="id8">
<a class="reference internal image-reference" href="_images/macx11.png"><img alt="_images/macx11.png" src="_images/macx11.png" style="width: 100%;" /></a>
<figcaption>
<p><span class="caption-text">Example of editing the X11 configuration in a terminal.</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>If emacs is use, save and close with <code class="code docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">X</span> <span class="pre">Ctrl</span> <span class="pre">S</span></code>, then <code class="code docutils literal notranslate"><span class="pre">Ctrl</span> <span class="pre">X</span> <span class="pre">Ctrl</span> <span class="pre">C</span></code>.</p>
<ol class="arabic simple" start="3">
<li><p>Restart the mac to force a restart of X11.</p></li>
</ol>
<p>A test is to use the small utility program <code class="code docutils literal notranslate"><span class="pre">glxgears</span></code>, which when started will
bring up a small window with 3 animated interlocking cogs that rotate.</p>
<p>This is based on advice found at: <a class="reference external" href="https://www.visitusers.org/index.php?title=Re-enabling_INdirect_GLX_on_your_X_server">https://www.visitusers.org/index.php?title=Re-enabling_INdirect_GLX_on_your_X_server</a> .</p>
</section>
<section id="programs-included">
<h2>Programs Included<a class="headerlink" href="#programs-included" title="Link to this heading"></a></h2>
<p>BDSIM is a program but it is accompanied by other programs for various tasks. Here is a complete
list of all executable programs included.</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Program</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>bdsim</p></td>
<td><p>The main tool to generate Monte Carlo simulation data.</p></td>
</tr>
<tr class="row-odd"><td><p>rebdsim</p></td>
<td><p>Analysis tool to make histograms and calcualte optics.</p></td>
</tr>
<tr class="row-even"><td><p>rebdsimCombine</p></td>
<td><p>Combine multiple rebdsim output files into 1 file.</p></td>
</tr>
<tr class="row-odd"><td><p>rebdsimHistoMerge</p></td>
<td><p>Operate on a bdsim output file and average the per-event
pre-made histograms only.</p></td>
</tr>
<tr class="row-even"><td><p>rebdsimOptics</p></td>
<td><p>Operate on a bdsim output file and calculate optical
functions from the sampler data - the ‘optics’.</p></td>
</tr>
<tr class="row-odd"><td><p>rebdsimOrbit</p></td>
<td><p>Operate on a bdsim output file and extrac the first
entry in each sampler - assuming 1 primary this is the
‘orbit’ of that particle.</p></td>
</tr>
<tr class="row-even"><td><p>bdskim</p></td>
<td><p>Create a copy of a bdsim output file keeping only select
events according to a selection - skim the data.</p></td>
</tr>
<tr class="row-odd"><td><p>bdsimCombine</p></td>
<td><p>Combine bdsim output files together into a bigger file.</p></td>
</tr>
<tr class="row-even"><td><p>bdsinterpolator</p></td>
<td><p>Load a field map and query it by inteprolation.</p></td>
</tr>
<tr class="row-odd"><td><p>comparator</p></td>
<td><p>Utility for numerically and statistically comparing bdsim
and rebdsim output files for regression testing.</p></td>
</tr>
<tr class="row-even"><td><p>makematerialfile</p></td>
<td><p>Export 2 files with materials and elements from NIST as
required by pyg4ometry.</p></td>
</tr>
<tr class="row-odd"><td><p>ptc2bdsim</p></td>
<td><p>Convert a PTC inrays file to one useable by bdsim.</p></td>
</tr>
<tr class="row-even"><td><p>gmad</p></td>
<td><p>The parser on its own as a program - no model is built.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="tested-platforms">
<span id="id7"></span><h2>Tested Platforms<a class="headerlink" href="#tested-platforms" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Mac OS 11.6.1 M1 (Big Sur), XCode 13.0 (Apple clang version 13.0.0 (clang-1300.0.29.3)), Geant4 11.0.0, ROOT 6.24/06, CLHEP, 2.4.4.2, Qt 5.15.2</p></li>
<li><p>Mac OS 11.6.1 M1 (Big Sur), XCode 13.0 (Apple clang version 13.0.0 (clang-1300.0.29.3)), Geant4 10.7.3, ROOT 6.24/06, CLHEP, 2.4.4.2, Qt 5.15.2</p></li>
<li><p>Mac OS 11.6.1 Intel (Big Sur), XCode 13.0 (Apple clang version 13.0.0 (clang-1300.0.29.3)), Geant4 11.0.0, ROOT 6.24/06, CLHEP, 2.4.4.2, Qt 5.15.2</p></li>
<li><p>Mac OS 11.6.1 Intel (Big Sur), XCode 13.0 (Apple clang version 13.0.0 (clang-1300.0.29.3)), Geant4 10.7.3, ROOT 6.24/06, CLHEP, 2.4.4.2, Qt 5.15.2</p></li>
<li><p>CERN CentOS 7, GCC 9.2.0, Geant4 10.7.2, 10.6, 10.4.3, ROOT 6.24.00, CLHEP 2.4.4.0 (i.e. lxplus at CERN with LCG100)</p></li>
<li><p>SLC6, GCC 4.9.3, Geant4 10.5.1, ROOT 6.10/08, CLHEP 2.3.3.0, Qt 5.7.0</p></li>
<li><p>SLC6 as above with Geant4 10.4.p02, Geant4 10.3.p03, Geant4 10.2.p03, Geant4 10.1.p03</p></li>
</ul>
<p>Recently tested:</p>
<ul class="simple">
<li><p>Mac OS 11.6.1 (Big Sur), XCode 12.5 (Apple clang version 12.0.5 (clang-1205.0.22.9)), Geant4 10.7.1, ROOT 6.24/00, CLHEP 2.4.4.1, Qt 5.15.2</p></li>
<li><p>Mac OSX 10.14.6 (Mojave), XCode 10.3 (Apple LLVM version 10.0.1 (clang-1001.0.46.4)), Geant4 10.7, ROOT 6.18/04, CLHEP 2.4.4.0, Qt 5.14.2</p></li>
<li><p>Mac OSX 10.14.6 (Mojave), XCode 10.3 (Apple LLVM version 10.0.1 (clang-1001.0.46.4)), Geant4 10.6.p02, ROOT 6.18/04, CLHEP 2.4.1.0, Qt 5.14.2</p></li>
<li><p>Mac OSX 10.14.3 (Mojave), XCode 10.1, Geant4 10.5, ROOT 6.16/00, CLHEP 2.4.1.0, Qt 5.12.0</p></li>
<li><p>Mac OSX 10.13.3 (High Sierra), XCode 10.1, Geant4 10.4.p02, ROOT 6.12/06, CLHEP 2.3.4.4, Qt 5.12.0</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="introduction.html" class="btn btn-neutral float-left" title="Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="running.html" class="btn btn-neutral float-right" title="Running BDSIM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>