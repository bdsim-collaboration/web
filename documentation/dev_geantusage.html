<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Geant4 User Action Classes &mdash; BDSIM 1.7.7.develop documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js?v=5d32c60e"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="_static/documentation_options.js?v=106dc6df"></script>
        <script src="_static/doctools.js?v=9a2dae69"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Geometry" href="dev_geometry.html" />
    <link rel="prev" title="Parser" href="dev_parser.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            BDSIM
              <img src="_static/bdsim-logo-small.jpg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.7.7.develop
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="licence.html">Licence &amp; Disclaimer</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running BDSIM</a></li>
<li class="toctree-l1"><a class="reference internal" href="input_syntax.html">Input Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_construction.html">Model Construction</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_control.html">Model Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_customisation.html">Model Customisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="model_conversion.html">Model Conversion</a></li>
<li class="toctree-l1"><a class="reference internal" href="externalgeometry.html">External Geometry Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="output_analysis.html">Output Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="python_utilities.html">Python Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="visualisation.html">Visualisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="interfacing.html">Interfacing</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples &amp; Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="support.html">Support</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="developer.html">Developer Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="dev_introduction.html">Purpose of Developer Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_contributing.html">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_testing.html">Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_styleguide.html">Style Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_documentation_build.html">Documentation Builds</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html">Release Checklist</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_release.html#change-of-year-or-licence">Change Of Year or Licence</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_programlayout.html">Program Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_buildsystem.html">Build System &amp; Testing</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_parser.html">Parser</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Geant4 User Action Classes</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#g4userrunaction">G4UserRunAction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bdsrunaction-generaterun">BDSRunAction::GenerateRun</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bdsrunaction-beginofrunaction">BDSRunAction::BeginOfRunAction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bdsrunaction-endofrunaction">BDSRunAction::EndOfRunAction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#g4usereventaction">G4UserEventAction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bdseventaction-beginofeventaction">BDSEventAction::BeginOfEventAction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bdseventaction-endofeventaction">BDSEventAction::EndOfEventAction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#g4userstackingaction">G4UserStackingAction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bdsstackingaction-classifynewtrack">BDSStackingAction::ClassifyNewTrack</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#g4usertrackingaction">G4UserTrackingAction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bdsusertrackingaction-preusertrackingaction">BDSUserTrackingAction::PreUserTrackingAction</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bdsusertrackingaction-postusertrackingaction">BDSUserTrackingAction::PostUserTrackingAction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#g4usersteppingaction">G4UserSteppingAction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#g4vuserprimarygeneratoraction">G4VUserPrimaryGeneratorAction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#bdsprimarygeneratoraction-generateprimaries">BDSPrimaryGeneratorAction::GeneratePrimaries</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="dev_geometry.html">Geometry</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_tracking.html">Tracking Algorithms</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_fields.html">Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_beamgeneration.html">Beam Generation</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysisoutput.html">Sensitivity, Output &amp; Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="dev_analysissuite.html">Analysis Suite</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="model_description.html">Model Description</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">BDSIM</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="developer.html">Developer Documentation</a></li>
      <li class="breadcrumb-item active">Geant4 User Action Classes</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dev_geantusage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="geant4-user-action-classes">
<span id="dev-geantusage"></span><h1>Geant4 User Action Classes<a class="headerlink" href="#geant4-user-action-classes" title="Link to this heading"></a></h1>
<p>Geant4 provides several base classes the developer can inherit, instantiate and register with
the Geant4 run manager as a way of taking various actions defined by the developer at different
stages of the simulation. These are described at <a class="reference external" href="http://geant4.web.cern.ch/geant4/G4UsersDocuments/UsersGuides/ForApplicationDeveloper/html/UserActions/OptionalActions.html">Geant4 user actions</a>.
They provide actions at each level of granularity in the simulation. The actions BDSIM takes in each of these are described
in the following sections.</p>
<section id="g4userrunaction">
<h2>G4UserRunAction<a class="headerlink" href="#g4userrunaction" title="Link to this heading"></a></h2>
<p>A ‘Run’ is the largest unit of simulation in Geant4 parlance. It is a simulation where all the
geometry, fields and physics are fixed and the same throughout. It typically contains many ‘Events’.</p>
<section id="bdsrunaction-generaterun">
<h3>BDSRunAction::GenerateRun<a class="headerlink" href="#bdsrunaction-generaterun" title="Link to this heading"></a></h3>
<p>This is not used, as BDSIM does not define its own Run object and uses the G4Run one.</p>
</section>
<section id="bdsrunaction-beginofrunaction">
<h3>BDSRunAction::BeginOfRunAction<a class="headerlink" href="#bdsrunaction-beginofrunaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>This histograms for the simulation (Run) are prepared and registered with the <code class="code docutils literal notranslate"><span class="pre">BDSAnalysisManager</span></code>.</p></li>
<li><p>The start time is printed out.</p></li>
</ul>
</section>
<section id="bdsrunaction-endofrunaction">
<h3>BDSRunAction::EndOfRunAction<a class="headerlink" href="#bdsrunaction-endofrunaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The stop time is printed out.</p></li>
<li><p>All histograms are written to the output.</p></li>
<li><p>Clean up</p></li>
</ul>
</section>
</section>
<section id="g4usereventaction">
<h2>G4UserEventAction<a class="headerlink" href="#g4usereventaction" title="Link to this heading"></a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note, the Primary Generator action is called before this method at the start of each event!</p>
</div>
<section id="bdseventaction-beginofeventaction">
<h3>BDSEventAction::BeginOfEventAction<a class="headerlink" href="#bdseventaction-beginofeventaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Sampler hits collections are created and registered.</p></li>
</ul>
</section>
<section id="bdseventaction-endofeventaction">
<h3>BDSEventAction::EndOfEventAction<a class="headerlink" href="#bdseventaction-endofeventaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Primary vertex coordinates are recorded.</p></li>
<li><p>Sampler, Cylindrical Sampler, Energy Deposition, Tunnel Energy Deposition hits are recorded in that order.</p></li>
<li><p>Primary impact points and loss points are recorded.</p></li>
<li><p>Output is written.</p></li>
<li><p>Trajectories matching filtering criteria are prepared and written to output.</p></li>
</ul>
</section>
</section>
<section id="g4userstackingaction">
<h2>G4UserStackingAction<a class="headerlink" href="#g4userstackingaction" title="Link to this heading"></a></h2>
<p>This allows the developer to fiddle the priority of particles (primary and secondary) based on their properties.</p>
<section id="bdsstackingaction-classifynewtrack">
<h3>BDSStackingAction::ClassifyNewTrack<a class="headerlink" href="#bdsstackingaction-classifynewtrack" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>All neutrinos are killed by default to save time on tracking.</p></li>
<li><p>If specified in <code class="code docutils literal notranslate"><span class="pre">GMAD::Options</span></code> stop tracks, the following secondary particles are killed:</p>
<ul>
<li><p>electrons, photons, positrons and protons/antiprotons</p></li>
</ul>
</li>
<li><p>If stop secondaries is specified, all secondaries are killed.</p></li>
<li><p>If the track is beyond the limit of tracks per event, it is killed.</p></li>
<li><p>If a particle is flagged as killed and it’s in a volume that has sensitivity an
attempt is made to process the sensitivity by dynamically casting the sensitive
detector to a variety of BDSIM ones.</p></li>
</ul>
</section>
</section>
<section id="g4usertrackingaction">
<h2>G4UserTrackingAction<a class="headerlink" href="#g4usertrackingaction" title="Link to this heading"></a></h2>
<p>The tracking action happens when a track is created (a new particle) and when it is finished
tracking.</p>
<section id="bdsusertrackingaction-preusertrackingaction">
<h3>BDSUserTrackingAction::PreUserTrackingAction<a class="headerlink" href="#bdsusertrackingaction-preusertrackingaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>Trajectories are stored if requested or as required for visualisation.</p></li>
<li><p>If no trajectories are required (turned off and in batch mode) a special reduced
trajectory is created for the primary particle only that marks its first impact
and its loss location.</p></li>
</ul>
</section>
<section id="bdsusertrackingaction-postusertrackingaction">
<h3>BDSUserTrackingAction::PostUserTrackingAction<a class="headerlink" href="#bdsusertrackingaction-postusertrackingaction" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>The primary particle loss point is flagged as in a collimator or not.</p></li>
</ul>
</section>
</section>
<section id="g4usersteppingaction">
<h2>G4UserSteppingAction<a class="headerlink" href="#g4usersteppingaction" title="Link to this heading"></a></h2>
<p>Only <code class="code docutils literal notranslate"><span class="pre">UserSteppingAction</span></code> is implemented and only to provide verbose output if required.</p>
</section>
<section id="g4vuserprimarygeneratoraction">
<h2>G4VUserPrimaryGeneratorAction<a class="headerlink" href="#g4vuserprimarygeneratoraction" title="Link to this heading"></a></h2>
<section id="bdsprimarygeneratoraction-generateprimaries">
<h3>BDSPrimaryGeneratorAction::GeneratePrimaries<a class="headerlink" href="#bdsprimarygeneratoraction-generateprimaries" title="Link to this heading"></a></h3>
<p>This uses a single particle gun and uses BDSBunch derived classes to generate various distributions
of single primary particles.</p>
<p><strong>Strong Reproducibility</strong></p>
<p>Note, the primary generator action is the first thing to be called per event that advances the random
number generator.  Therefore, the seed state is saved and restored here.  If strong reproduction is
requested using the executable flag <code class="code docutils literal notranslate"><span class="pre">--recreate=&lt;file&gt;</span></code>, the options will be loaded from the
output file, including the bunch distribution, and all will be recreated.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dev_parser.html" class="btn btn-neutral float-left" title="Parser" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dev_geometry.html" class="btn btn-neutral float-right" title="Geometry" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Beam Delivery Simulation (BDSIM) Copyright (c) Royal Holloway, University of London, 2001 - 2025.
      <span class="lastupdated">Last updated on Jun 13, 2025.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-JYMKZHVZJ2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-JYMKZHVZJ2', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>